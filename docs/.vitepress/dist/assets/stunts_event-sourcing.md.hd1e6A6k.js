import{_ as i,c as a,o as t,ae as n}from"./chunks/framework.DvGhUH3j.js";const d=JSON.parse('{"title":"Event Sourcing","description":"","frontmatter":{},"headers":[],"relativePath":"stunts/event-sourcing.md","filePath":"stunts/event-sourcing.md"}'),e={name:"stunts/event-sourcing.md"};function h(l,s,p,k,r,o){return t(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="event-sourcing" tabindex="-1">Event Sourcing <a class="header-anchor" href="#event-sourcing" aria-label="Permalink to &quot;Event Sourcing&quot;">​</a></h1><blockquote><p><strong>The Stunt:</strong> Treating Git commits as immutable domain events, and &quot;replaying&quot; history to build application state.</p></blockquote><p>Event Sourcing is a pattern where you don&#39;t store the &quot;current state&quot; (e.g., <code>User: { name: &quot;Alice&quot; }</code>). Instead, you store the sequence of events that led there:</p><ol><li><code>UserCreated { name: &quot;Alice&quot; }</code></li><li><code>UserRenamed { newName: &quot;Al&quot; }</code></li></ol><p>Git is natively an event store. It is an append-only log of immutable changes.</p><h2 id="the-implementation" tabindex="-1">The Implementation <a class="header-anchor" href="#the-implementation" aria-label="Permalink to &quot;The Implementation&quot;">​</a></h2><p>With EmptyGraph, every node is an event.</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. Store an event</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  message: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;OrderPlaced&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, amount: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  parents: [previousEventSha] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Link to the chain</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. Replay to build state</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> balance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Note: ancestors() goes backwards in time, so we reverse it</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> history</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.traversal.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ancestors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ sha: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HEAD&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  history.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node.message));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> history.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reverse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (event.type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;OrderPlaced&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) balance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.amount;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (event.type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Refunded&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) balance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.amount;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="branching-alternate-timelines" tabindex="-1">Branching = Alternate Timelines <a class="header-anchor" href="#branching-alternate-timelines" aria-label="Permalink to &quot;Branching = Alternate Timelines&quot;">​</a></h2><p>Because it&#39;s Git, you can branch your event stream.</p><ul><li><strong>Main Branch:</strong> The &quot;official&quot; history.</li><li><strong>Feature Branch:</strong> A &quot;What If&quot; simulation.</li></ul><p>You can replay a &quot;simulation branch&quot; to see what the state <em>would</em> be if you cancelled an order, without affecting the main timeline. This is incredibly powerful for financial modeling or game state prediction.</p><h2 id="cryptographic-proof" tabindex="-1">Cryptographic Proof <a class="header-anchor" href="#cryptographic-proof" aria-label="Permalink to &quot;Cryptographic Proof&quot;">​</a></h2><p>Every state is cryptographically verifiable. If you have the SHA of the tip of the branch, you have a mathematical guarantee that the entire history leading up to it has not been tampered with. This is built-in Blockchain tech, without the Blockchain hype.</p>`,14)])])}const c=i(e,[["render",h]]);export{d as __pageData,c as default};
