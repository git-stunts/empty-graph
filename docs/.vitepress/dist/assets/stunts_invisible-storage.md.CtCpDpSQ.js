import{_ as i,c as a,o as t,ae as e}from"./chunks/framework.DvGhUH3j.js";const g=JSON.parse('{"title":"Invisible Metadata","description":"","frontmatter":{},"headers":[],"relativePath":"stunts/invisible-storage.md","filePath":"stunts/invisible-storage.md"}'),n={name:"stunts/invisible-storage.md"};function h(o,s,l,r,p,k){return t(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="invisible-metadata" tabindex="-1">Invisible Metadata <a class="header-anchor" href="#invisible-metadata" aria-label="Permalink to &quot;Invisible Metadata&quot;">​</a></h1><blockquote><p><strong>The Stunt:</strong> Storing rich application state inside your <code>.git</code> folder without creating a single file in your working directory.</p></blockquote><p>This is the feature that usually breaks people&#39;s brains.</p><p>When you use <strong>EmptyGraph</strong>, you are interacting with Git, but you are not touching the &quot;Index&quot; (staging area) or the &quot;Work Tree&quot; (your files). You are bypassing them and writing directly to the <strong>Object Database</strong> (the <code>.git/objects</code> folder).</p><h2 id="the-empty-tree-pattern" tabindex="-1">The &quot;Empty Tree&quot; Pattern <a class="header-anchor" href="#the-empty-tree-pattern" aria-label="Permalink to &quot;The &quot;Empty Tree&quot; Pattern&quot;">​</a></h2><p>Every commit in Git points to a &quot;Tree&quot; object (a snapshot of a directory). Usually, that tree contains your source code.</p><p>But a tree can be empty. The SHA-1 of an empty tree is always constant:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>4b825dc642cb6eb9a060e54bf8d69288fbee4904</span></span></code></pre></div><p>We create commits that point to <em>this</em> tree.</p><ul><li><strong>Files:</strong> 0</li><li><strong>Data:</strong> Stored in the &quot;Commit Message&quot;</li><li><strong>History:</strong> Fully preserved</li></ul><h2 id="use-case-the-shadow-database" tabindex="-1">Use Case: The &quot;Shadow&quot; Database <a class="header-anchor" href="#use-case-the-shadow-database" aria-label="Permalink to &quot;Use Case: The &quot;Shadow&quot; Database&quot;">​</a></h2><p>Imagine you are building a CLI tool. You want to store configuration, usage history, or user preferences.</p><p><strong>The Old Way:</strong></p><ul><li>Write to <code>~/.config/my-tool/config.json</code>.</li><li>Now you have to manage file permissions, paths, JSON parsing corruption.</li></ul><p><strong>The EmptyGraph Way:</strong></p><ul><li>Initialize a hidden git repo.</li><li>Write updates as commits to a detached branch or a custom ref (e.g., <code>refs/shadow/config</code>).</li></ul><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Write config</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sha</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  message: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ theme: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;dark&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, retries: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> plumbing.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;refs/shadow/config&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, sha);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Read config</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> headSha</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> plumbing.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;refs/shadow/config&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(headSha));</span></span></code></pre></div><h2 id="why" tabindex="-1">Why? <a class="header-anchor" href="#why" aria-label="Permalink to &quot;Why?&quot;">​</a></h2><ol><li><strong>It&#39;s Clean:</strong> No pollution of the user&#39;s home directory with random config files.</li><li><strong>It&#39;s Auditable:</strong> You have a complete history of every configuration change ever made. &quot;Why did my theme change?&quot; -&gt; Check the log.</li><li><strong>It&#39;s Syncable:</strong> It&#39;s just a Git ref. You can <code>git push</code> it to a remote for backup or sync it between machines.</li></ol><h2 id="the-rootkit-database" tabindex="-1">The &quot;Rootkit&quot; Database <a class="header-anchor" href="#the-rootkit-database" aria-label="Permalink to &quot;The &quot;Rootkit&quot; Database&quot;">​</a></h2><p>We call this the &quot;Rootkit&quot; pattern (metaphorically!) because it exists in a layer <em>underneath</em> what the user perceives as &quot;the filesystem.&quot; It is persistent, versioned, and invisible.</p>`,21)])])}const c=i(n,[["render",h]]);export{g as __pageData,c as default};
