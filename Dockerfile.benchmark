FROM node:22-slim

RUN apt-get update && apt-get install -y git && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy all repos into /app/packages for local linking
COPY plumbing /app/packages/plumbing
COPY empty-graph /app/packages/empty-graph

# Setup plumbing
WORKDIR /app/packages/plumbing
RUN npm install

# Setup empty-graph
WORKDIR /app/packages/empty-graph
RUN npm install
RUN npm link ../plumbing

ENV GIT_STUNTS_DOCKER=1

CMD ["node", "benchmarks/benchmark.js"]
